on:
  workflow_call:
    inputs:
      apt-packages:
        required: false
        type: string
      gh-pages:
        default: false
        required: false
        type: boolean
      python-version:
        default: "3.8"
        required: false
        type: string

jobs:
  linkcheck:
    uses: ./.github/workflows/linkcheck.yml
    with:
      apt-packages: ${{ inputs.apt-packages }}
      python-version: ${{ inputs.python-version }}

  docnb:
    name: nb
    uses: ./.github/workflows/docnb.yml
    with:
      apt-packages: ${{ inputs.apt-packages }}
      python-version: ${{ inputs.python-version }}

  gh-pages:
    name: Upload to GitHub Pages
    if: inputs.gh-pages && github.event_name == 'push' && github.ref == format('refs/heads/{0}', github.event.repository.default_branch)
    needs:
      - docnb
      - linkcheck
    permissions:
      pages: write
      id-token: write
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/deploy-pages@v1
